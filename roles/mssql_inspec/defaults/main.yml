---
# MSSQL InSpec Role - Default Variables
# ======================================

# MSSQL Connection Parameters (Required)
mssql_server: ""
mssql_port: 1433
mssql_database: "master"
mssql_username: ""
mssql_password: ""
mssql_version: "2019"
mssql_service: ""  # Named instance (optional)

# Execution Mode
# - "localhost" or empty: Run InSpec on Ansible control node
# - "<hostname>": Run InSpec on remote delegate host via SSH
inspec_delegate_host: "localhost"

# ======================
# Connection Mode
# ======================
# When true, use WinRM transport with Windows/AD authentication
# When false, use direct TDS connection via sqlcmd (SQL authentication)
use_winrm: false

# ======================
# WinRM Configuration (Windows/AD Authentication)
# ======================
# Only used when use_winrm: true
# Target URL format: winrm://hostname (port 5985 is default)
#
# IMPORTANT: Username MUST include domain for AD authentication
# Use UPN format: username@domain.com (recommended)
# Or down-level format: DOMAIN\\username
# A bare username will fail with WinRM::WinRMAuthorizationError
winrm_username: ""
winrm_password: ""

# ======================
# AAP2 Parallel Execution
# ======================
# For large-scale scanning (300+ hosts), use AAP2 Job Slicing:
#   Job Template â†’ Job Slicing: 10 (runs 10 parallel jobs)
#   Combined with forks: 20 = 200 hosts scanned simultaneously
#
# Recommended AAP2 Job Template Settings:
#   - Forks: 20-30
#   - Job Slicing: 10
#   - Timeout: 3600 (1 hour per slice)
#   - Instance Groups: Multiple execution nodes
#
# Throttle controls max concurrent scans from this role
# Set lower than forks to prevent delegate host overload
scan_throttle: 10                 # Max concurrent scans (0 = unlimited)

# ======================
# Batch Processing
# ======================
batch_size: 0                     # 0 = no batching (use AAP2 slicing instead)
batch_delay: 0                    # Seconds between batches (0 for parallel)
scan_timeout: 600                 # Per-host timeout (seconds) - increased for safety

# ======================
# Error Handling
# ======================
continue_on_winrm_failure: true   # Continue if WinRM connection fails
max_retry_attempts: 2             # Retry failed WinRM connections
retry_delay: 10                   # Seconds between retries

# Results Configuration
inspec_results_dir: "/tmp/inspec_mssql_results"
generate_summary_report: true
cleanup_temp_files: true

# Debug Mode - shows additional output
inspec_debug_mode: false

# Pre-flight Check Configuration
# ==============================
# Enable/disable pre-flight connectivity checks before InSpec scan
preflight_enabled: true

# Timeout for TCP port connectivity check (seconds)
preflight_port_timeout: 5

# Timeout for authentication/query test (seconds)
preflight_auth_timeout: 10

# Continue processing other databases if this one fails preflight
# When true: skips this database and continues with others
# When false: fails the entire playbook on first unreachable database
preflight_continue_on_failure: true

# Splunk Integration (optional)
send_to_splunk: false
splunk_hec_url: ""
splunk_hec_token: ""
splunk_index: "compliance_scans"

# Supported MSSQL versions (for validation)
supported_mssql_versions:
  - "2016"
  - "2017"
  - "2018"
  - "2019"
  - "2022"

# ======================
# Enhanced Error Reporting (DBSCAN-710)
# ======================
# Generate consolidated failed hosts report at end of batch execution
generate_failed_hosts_report: true

# Export failed hosts as JSON for downstream processing
export_failed_hosts_json: true

# Failed hosts report filename (in inspec_results_dir)
failed_hosts_report_file: "failed_hosts_summary.json"

# Include remediation suggestions in error reports
include_remediation_hints: true

# Error notification settings
notify_on_scan_errors: false
notification_email: ""
notification_webhook_url: ""
