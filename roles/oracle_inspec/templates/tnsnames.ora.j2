# tnsnames.ora - Oracle Net Services configuration
# Generated by Ansible for InSpec compliance scanning
# Managed by: oracle_inspec role
# Generated: {{ ansible_date_time.iso8601 }}
#
# WARNING: This file is managed by Ansible. Manual changes will be overwritten.

{% if oracle_databases is defined and oracle_databases | length > 0 %}
{# Multiple databases from inventory #}
{% for db in oracle_databases %}
{{ db.tns_alias | default(db.service | default(db.name)) | upper }} =
  (DESCRIPTION =
    (ADDRESS = (PROTOCOL = TCP)(HOST = {{ db.host }})(PORT = {{ db.port | default(oracle_port | default(1521)) }}))
    (CONNECT_DATA =
{% if db.service_type | default(oracle_service_type) | default('service_name') == 'sid' %}
      (SID = {{ db.service | default(db.sid) }})
{% else %}
      (SERVICE_NAME = {{ db.service | default(db.service_name) }})
{% endif %}
    )
  )

{% endfor %}
{% else %}
{# Single database from individual variables #}
{{ oracle_tns_alias | default(oracle_service | default('ORCL')) | upper }} =
  (DESCRIPTION =
    (ADDRESS = (PROTOCOL = TCP)(HOST = {{ oracle_server }})(PORT = {{ oracle_port | default(1521) }}))
    (CONNECT_DATA =
{% if oracle_service_type | default('service_name') == 'sid' %}
      (SID = {{ oracle_service | default(oracle_sid) }})
{% else %}
      (SERVICE_NAME = {{ oracle_service | default(oracle_service_name) }})
{% endif %}
    )
  )

{% endif %}
{# Optional: Add listener configuration for local connections #}
{% if oracle_listener_name is defined %}
LISTENER_{{ oracle_listener_name | upper }} =
  (ADDRESS = (PROTOCOL = TCP)(HOST = {{ oracle_server }})(PORT = {{ oracle_port | default(1521) }}))

{% endif %}
